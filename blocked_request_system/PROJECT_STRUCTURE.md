# é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
blocked_request_system/
â”œâ”€â”€ src/                           # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ blocked_request_db.h      # æ•°æ®åº“ç®¡ç†å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ blocked_request_db.cc     # æ•°æ®åº“ç®¡ç†å®ç°
â”‚   â”œâ”€â”€ smart_batch_manager.h     # æ‰¹é‡ç®¡ç†å¤´æ–‡ä»¶
â”‚   â””â”€â”€ smart_batch_manager.cc    # æ‰¹é‡ç®¡ç†å®ç°
â”œâ”€â”€ test/                          # æµ‹è¯•ä»£ç å’Œå·¥å…·
â”‚   â”œâ”€â”€ create_test_data.cpp      # æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ create_test_data          # ç¼–è¯‘åçš„æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ simulate_browser.cpp      # æµè§ˆå™¨æ¨¡æ‹Ÿå™¨
â”‚   â”œâ”€â”€ simulate_browser          # ç¼–è¯‘åçš„æµè§ˆå™¨æ¨¡æ‹Ÿå™¨
â”‚   â”œâ”€â”€ reader_program.cpp        # æ•°æ®åº“è¯»å–ç¨‹åº
â”‚   â”œâ”€â”€ reader_program            # ç¼–è¯‘åçš„æ•°æ®åº“è¯»å–ç¨‹åº
â”‚   â”œâ”€â”€ test_database.sh          # æ•°æ®åº“æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ quick_queries.sql         # SQLæŸ¥è¯¢ç¤ºä¾‹
â”œâ”€â”€ build/                         # CMakeæ„å»ºç›®å½•
â”œâ”€â”€ CMakeLists.txt                 # CMakeæ„å»ºé…ç½®
â”œâ”€â”€ Makefile                       # Makeæ„å»ºé…ç½®
â”œâ”€â”€ README.md                      # é¡¹ç›®ä¸»è¯´æ˜
â”œâ”€â”€ README_TESTING.md              # æµ‹è¯•ç³»ç»Ÿè¯´æ˜
â”œâ”€â”€ DATABASE_GUIDE.md              # æ•°æ®åº“æ“ä½œæŒ‡å—
â”œâ”€â”€ PROJECT_STRUCTURE.md           # é¡¹ç›®ç»“æ„è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â””â”€â”€ test_blocked_requests.db      # æµ‹è¯•æ•°æ®åº“æ–‡ä»¶
```

## ğŸ—ï¸ æ„å»ºç³»ç»Ÿ

### Makefile æ„å»º
```bash
# ç¼–è¯‘æ•´ä¸ªé¡¹ç›®
make

# æ¸…ç†ç¼–è¯‘æ–‡ä»¶
make clean

# æŸ¥çœ‹å¸®åŠ©
make help
```

### CMake æ„å»º
```bash
# åˆ›å»ºæ„å»ºç›®å½•
mkdir -p build && cd build

# é…ç½®å’Œç¼–è¯‘
cmake .. && make
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. æ•°æ®åº“ç®¡ç† (`src/blocked_request_db.*`)
- **åŠŸèƒ½**ï¼šSQLiteæ•°æ®åº“çš„å°è£…ç®¡ç†
- **ç‰¹æ€§**ï¼šæ”¯æŒWALæ¨¡å¼ã€å¤šè¿›ç¨‹å¹¶å‘ã€æ‰¹é‡æ“ä½œ
- **å­—æ®µ**ï¼šid, url, host, reason, timestamp, reported, browser_id, tab_id

### 2. æ‰¹é‡ç®¡ç† (`src/smart_batch_manager.*`)
- **åŠŸèƒ½**ï¼šæ™ºèƒ½æ‰¹é‡å¤„ç†æ‹¦æˆªè¯·æ±‚
- **ç‰¹æ€§**ï¼šè‡ªåŠ¨åˆ·æ–°ã€å®šæ—¶åˆ·æ–°ã€å¤§å°è§¦å‘åˆ·æ–°

## ğŸ§ª æµ‹è¯•å·¥å…·

### 1. æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨ (`test/create_test_data`)
- **åŠŸèƒ½**ï¼šç”Ÿæˆ100æ¡æ¨¡æ‹Ÿæ‹¦æˆªè¯·æ±‚è®°å½•
- **æ•°æ®ç‰¹ç‚¹**ï¼šåŒ…å«10ç§åŸŸåã€10ç§è·¯å¾„ã€10ç§åŸå› ã€5ç§æ ‡è¯†åº—é“ºã€1-20æ ‡ç­¾é¡µID

### 2. æµè§ˆå™¨æ¨¡æ‹Ÿå™¨ (`test/simulate_browser`)
- **åŠŸèƒ½**ï¼šæ¨¡æ‹Ÿæµè§ˆå™¨ç”Ÿæˆæ‹¦æˆªè¯·æ±‚
- **ç‰¹æ€§**ï¼šå®æ—¶ç”Ÿæˆã€éšæœºå»¶è¿Ÿã€æ‰¹é‡ç®¡ç†

### 3. æ•°æ®åº“è¯»å–ç¨‹åº (`test/reader_program`)
- **åŠŸèƒ½**ï¼šè¯»å–å¹¶å¤„ç†æœªä¸ŠæŠ¥çš„æ‹¦æˆªè¯·æ±‚
- **ç‰¹æ€§**ï¼šæ¨¡æ‹Ÿä¸ŠæŠ¥è¿‡ç¨‹ã€çŠ¶æ€æ›´æ–°ã€ç»Ÿè®¡ä¿¡æ¯

### 4. æ•°æ®åº“æµ‹è¯•è„šæœ¬ (`test/test_database.sh`)
- **åŠŸèƒ½**ï¼šæ¼”ç¤ºå„ç§æ•°æ®åº“æŸ¥è¯¢æ“ä½œ
- **åŒ…å«æµ‹è¯•**ï¼šåŸºæœ¬ä¿¡æ¯ã€åˆ†ç±»ç»Ÿè®¡ã€æ—¶é—´æŸ¥è¯¢ã€ç‰¹å®šæŸ¥è¯¢

## ğŸ“Š æ•°æ®åº“ç»“æ„

### è¡¨ï¼š`blocked_requests`
```sql
CREATE TABLE blocked_requests (
    id INTEGER PRIMARY KEY AUTOINCREMENT,  -- ä¸»é”®ID
    url TEXT NOT NULL,                     -- å®Œæ•´URL
    host TEXT NOT NULL,                    -- åŸŸå
    reason TEXT NOT NULL,                  -- æ‹¦æˆªåŸå› 
    timestamp INTEGER NOT NULL,            -- æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
    reported INTEGER DEFAULT 0,            -- ä¸ŠæŠ¥çŠ¶æ€
    browser_id TEXT DEFAULT '',            -- æ ‡è¯†åº—é“º
    tab_id INTEGER DEFAULT 0               -- æ ‡ç­¾é¡µID
);
```

### ç´¢å¼•
- `idx_timestamp` - æ—¶é—´æˆ³ç´¢å¼•
- `idx_reported` - ä¸ŠæŠ¥çŠ¶æ€ç´¢å¼•
- `idx_host` - åŸŸåç´¢å¼•
- `idx_browser_id` - æ ‡è¯†åº—é“ºç´¢å¼•
- `idx_tab_id` - æ ‡ç­¾é¡µIDç´¢å¼•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘é¡¹ç›®
```bash
make clean && make
```

### 2. åˆ›å»ºæµ‹è¯•æ•°æ®
```bash
./test/create_test_data
```

### 3. è¿è¡Œæµ‹è¯•
```bash
./test/test_database.sh
```

### 4. è¿è¡Œæ¨¡æ‹Ÿå™¨
```bash
./test/simulate_browser
```

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„æ ¸å¿ƒåŠŸèƒ½
1. åœ¨ `src/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æºæ–‡ä»¶
2. æ›´æ–° `Makefile` å’Œ `CMakeLists.txt`
3. åœ¨ `src/` ç›®å½•ä¸‹ç¼–è¯‘

### æ·»åŠ æ–°çš„æµ‹è¯•
1. åœ¨ `test/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æµ‹è¯•æ–‡ä»¶
2. æ›´æ–° `Makefile` å’Œ `CMakeLists.txt`
3. åœ¨ `test/` ç›®å½•ä¸‹ç¼–è¯‘

### æ•°æ®åº“å­—æ®µä¿®æ”¹
1. æ›´æ–° `src/blocked_request_db.h` ä¸­çš„ç»“æ„ä½“
2. æ›´æ–° `src/blocked_request_db.cc` ä¸­çš„SQLè¯­å¥
3. æ›´æ–°æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
4. æ›´æ–°æ–‡æ¡£è¯´æ˜

## ğŸ” æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶
- `blocked_request_db.*` - æ•°æ®åº“ç®¡ç†æ ¸å¿ƒ
- `smart_batch_manager.*` - æ‰¹é‡å¤„ç†ç®¡ç†
- `browser_view.*` - æµè§ˆå™¨è§†å›¾ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- `global_infobar.*` - å…¨å±€ä¿¡æ¯æ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

### æµ‹è¯•æ–‡ä»¶
- `create_test_data.*` - æµ‹è¯•æ•°æ®ç”Ÿæˆ
- `simulate_browser.*` - æµè§ˆå™¨æ¨¡æ‹Ÿ
- `reader_program.*` - æ•°æ®è¯»å–æµ‹è¯•
- `test_database.sh` - æ•°æ®åº“æµ‹è¯•è„šæœ¬
- `quick_queries.sql` - SQLæŸ¥è¯¢ç¤ºä¾‹

### é…ç½®æ–‡ä»¶
- `Makefile` - Makeæ„å»ºé…ç½®
- `CMakeLists.txt` - CMakeæ„å»ºé…ç½®
- `*.md` - å„ç§è¯´æ˜æ–‡æ¡£

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `README.md` - é¡¹ç›®æ€»ä½“è¯´æ˜
- `README_TESTING.md` - æµ‹è¯•ç³»ç»Ÿè¯¦ç»†è¯´æ˜
- `DATABASE_GUIDE.md` - æ•°æ®åº“æ“ä½œå®Œæ•´æŒ‡å—
- `USAGE.md` - ä½¿ç”¨è¯´æ˜ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

---

**æ³¨æ„**ï¼šæ­¤é¡¹ç›®ç»“æ„æ”¯æŒå¤šè¿›ç¨‹å¹¶å‘è®¿é—®SQLiteæ•°æ®åº“ï¼Œä½¿ç”¨WALæ¨¡å¼ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚
